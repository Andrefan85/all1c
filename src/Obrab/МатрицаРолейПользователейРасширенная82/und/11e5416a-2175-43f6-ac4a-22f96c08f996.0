{3,
{38,0,0,0,0,1,0,0,00000000-0000-0000-0000-000000000000,1,
{1,0},0,0,1,1,1,0,1,0,
{3,1d632984-de3c-4b4b-ad9f-d69682a10182,"ОбработкаВыбора",3ccc650e-f631-4cae-8e33-3eaac610b5f9,"ПриОткрытии",9f2e5ddb-3492-4f5d-8f0d-416b8d1d5c5b,"ПриСозданииНаСервере"},
{0},1,
{19,
{-1,02023637-7868-4a5f-8576-835a76e0c9ba},0,0,1,
{0,
{0,
{"B",1},0}
},9,"ФормаКоманднаяПанель",
{1,0},
{1,0},0,1,0,0,0,2,2,
{3,4,
{0}
},
{7,3,0,1,100},
{0,0,0},1,
{0,0,0},0,1,0,0},3,cd5394d0-7dda-4b56-8927-93ccbe967a01,
{19,
{6,02023637-7868-4a5f-8576-835a76e0c9ba},0,0,1,
{0,
{0,
{"B",1},0}
},0,"ГруппаКоманднаяПанель",
{1,1,
{"ru","Группа командная панель"}
},
{1,1,
{"ru","Группа командная панель"}
},0,1,0,0,0,2,2,
{3,4,
{0}
},
{7,3,0,1,100},
{0,0,0},1,
{1,0,
{1,02023637-7868-4a5f-8576-835a76e0c9ba}
},6,a9f3b1ac-f51b-431e-b102-55a69acdecad,
{25,
{3,02023637-7868-4a5f-8576-835a76e0c9ba},0,1,
{0,
{0,
{"B",1},0}
},0,"ФормаСписокРолей",
{1,0},1,
{1,409b9a53-7f7e-4178-86c1-33176c7c7a7a},
{0},3,0,0,0,2,2,0,0,0,
{3,4,
{0}
},
{3,4,
{0}
},
{3,4,
{0}
},
{7,3,0,1,100},
{0,0,0},0,
{4,0,
{0},"",-1,-1,1,0,""},1,
{"Pattern"},"",2,0,1,
{8,
{15,02023637-7868-4a5f-8576-835a76e0c9ba},0,0,1,
{0,
{0,
{"B",1},0}
},0,"ФормаСписокРолейExtendedTooltip",
{1,0},
{1,0},1,0,0,2,2,
{3,4,
{0}
},
{7,3,0,1,100},
{0,0,0},1,
{5,0,0,3,0,
{0},
{3,4,
{0}
},
{3,4,
{0}
},
{3,0,
{0},0,1,0,48312c09-257f-4b29-b280-284dd89efc1e}
},0,1,2,
{1,
{1,0},0},0,0},
{"U"},1,0,0,1,0,0,0,3,3,3},a9f3b1ac-f51b-431e-b102-55a69acdecad,
{25,
{4,02023637-7868-4a5f-8576-835a76e0c9ba},0,1,
{0,
{0,
{"B",1},0}
},0,"ФормаУстановить",
{1,0},1,
{2,409b9a53-7f7e-4178-86c1-33176c7c7a7a},
{0},3,0,0,0,2,2,0,0,0,
{3,4,
{0}
},
{3,4,
{0}
},
{3,4,
{0}
},
{7,3,0,1,100},
{0,0,0},0,
{4,0,
{0},"",-1,-1,1,0,""},1,
{"Pattern"},"",2,0,1,
{8,
{16,02023637-7868-4a5f-8576-835a76e0c9ba},0,0,1,
{0,
{0,
{"B",1},0}
},0,"ФормаУстановитьExtendedTooltip",
{1,0},
{1,0},1,0,0,2,2,
{3,4,
{0}
},
{7,3,0,1,100},
{0,0,0},1,
{5,0,0,3,0,
{0},
{3,4,
{0}
},
{3,4,
{0}
},
{3,0,
{0},0,1,0,48312c09-257f-4b29-b280-284dd89efc1e}
},0,1,2,
{1,
{1,0},0},0,0},
{"U"},1,0,0,1,0,0,0,3,3,3},a9f3b1ac-f51b-431e-b102-55a69acdecad,
{25,
{5,02023637-7868-4a5f-8576-835a76e0c9ba},0,1,
{0,
{0,
{"B",1},0}
},0,"ФормаСнять",
{1,0},1,
{3,409b9a53-7f7e-4178-86c1-33176c7c7a7a},
{0},3,0,0,0,2,2,0,0,0,
{3,4,
{0}
},
{3,4,
{0}
},
{3,4,
{0}
},
{7,3,0,1,100},
{0,0,0},0,
{4,0,
{0},"",-1,-1,1,0,""},1,
{"Pattern"},"",2,0,1,
{8,
{17,02023637-7868-4a5f-8576-835a76e0c9ba},0,0,1,
{0,
{0,
{"B",1},0}
},0,"ФормаСнятьExtendedTooltip",
{1,0},
{1,0},1,0,0,2,2,
{3,4,
{0}
},
{7,3,0,1,100},
{0,0,0},1,
{5,0,0,3,0,
{0},
{3,4,
{0}
},
{3,4,
{0}
},
{3,0,
{0},0,1,0,48312c09-257f-4b29-b280-284dd89efc1e}
},0,1,2,
{1,
{1,0},0},0,0},
{"U"},1,0,0,1,0,0,0,3,3,3},a9f3b1ac-f51b-431e-b102-55a69acdecad,
{25,
{7,02023637-7868-4a5f-8576-835a76e0c9ba},0,1,
{0,
{0,
{"B",1},0}
},0,"ФормаОбновить",
{1,0},1,
{4,409b9a53-7f7e-4178-86c1-33176c7c7a7a},
{0},3,0,0,0,2,2,0,0,0,
{3,4,
{0}
},
{3,4,
{0}
},
{3,4,
{0}
},
{7,3,0,1,100},
{0,0,0},0,
{4,0,
{0},"",-1,-1,1,0,""},1,
{"Pattern"},"",2,0,1,
{8,
{18,02023637-7868-4a5f-8576-835a76e0c9ba},0,0,1,
{0,
{0,
{"B",1},0}
},0,"ФормаОбновитьExtendedTooltip",
{1,0},
{1,0},1,0,0,2,2,
{3,4,
{0}
},
{7,3,0,1,100},
{0,0,0},1,
{5,0,0,3,0,
{0},
{3,4,
{0}
},
{3,4,
{0}
},
{3,0,
{0},0,1,0,48312c09-257f-4b29-b280-284dd89efc1e}
},0,1,2,
{1,
{1,0},0},0,0},
{"U"},1,0,0,1,0,0,0,3,3,3},a9f3b1ac-f51b-431e-b102-55a69acdecad,
{25,
{13,02023637-7868-4a5f-8576-835a76e0c9ba},0,1,
{0,
{0,
{"B",1},0}
},0,"ФормаПроголосовать",
{1,0},1,
{5,409b9a53-7f7e-4178-86c1-33176c7c7a7a},
{0},3,0,0,0,2,2,0,0,0,
{3,4,
{0}
},
{3,4,
{0}
},
{3,4,
{0}
},
{7,3,0,1,100},
{0,0,0},0,
{4,3,
{0},"",-1,-1,0,
{
{#base64:R0lGODlhEgARAPcAAP9KAP+LVu/y6v9hFf/q9P5mGf9mG/+ofiylK63xk67xkh2M
E/wxABKkI/7///9aC/3n3CGkG/9uKP9eFySkH/5eG5jjgvViGPLHqv/ApTGkMf/M
tf75/xmlDf/n3v+6mRWlBv+7bP9VAA93AAl+CYvuXf+1kv+qlf/t8p3ud/+SXJnq
dh+XD/+keP+7qP/u5QCTAPhNAP/AuwCNAESzQ4nbev/Ms/tbC5vtef+PWYqyGkO4
Tf93SSqjDa3vkv13NP/s4v9/QiyqJv+fb6b6hv+ofUvaHv+BQv/SyP/c1fNLACWh
EHGwb//3+v/59SF5AP9yLPf7+zGPL3vpS6DljP/v5//h0mapY8n/qv58O7b9l1TF
QIXtcf9hFHyYTf97Ov6pf////v/NthWiJGHhN/+ESf+HSwmjAHLTZv/TvDSYGfz7
/yuYFv+JXtDo1f+MU/++o/+xlf/Mtw2MCXzmVbb1mRekGJ7wfR6tEeVAAI3uev/9
/QuVCCWRC5j6dyinI3P2bZjvbf+UdKD5dv+smhOwAMTytKLvfDCmLRqdHfYsAP9h
E/8zAP/Co6XxiI7seP+9nPrh1P1RAP/Ezv9nHP38/+Lz5J7sf//p3v/byP/Cq3Xv
eP/07PL39v9jGPpSAP/PuP+LVf9sJQ2pACWjC6vrmP/39P+ZZgCjER2NF4btcZXu
af+uielMAP+icyWWHf+tg3fmWhWcDf///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAACH5BAAAAAAALAAAAAASABEAAAjvAGcJHCjwBcGDCGepgAIk
YcIcRQ4McYhwQBVOlDxQHJjpi6k9QZJsFBjqlBVMmrzsoMGEoJMfn24sEpEGlBgU
fNDUmCFg4BFPLWBB2oAETgYCdozciYBhoA1Gbz6YiBPChYxJLMg4orCGYKMYBVgR
0kGKjRoYdOogSITozxWBDgx0ObFkk6pHl3D4METFQilZA109ENQDkB8iWhSsOLRq
ChYhA5WIatMHVYMxGhKk2NIBBJ5UAsNIKhPgQp5WFUboCXTGTSdLHARmAWAGwAQ5
TXg84VJiVKWDYBgokkBwQaxBhaIghBDpoJQ5r0gQDAgAOw==}
},0,""},1,
{"Pattern"},"",2,0,1,
{8,
{19,02023637-7868-4a5f-8576-835a76e0c9ba},0,0,1,
{0,
{0,
{"B",1},0}
},0,"ФормаПроголосоватьExtendedTooltip",
{1,0},
{1,0},1,0,0,2,2,
{3,4,
{0}
},
{7,3,0,1,100},
{0,0,0},1,
{5,0,0,3,0,
{0},
{3,4,
{0}
},
{3,4,
{0}
},
{3,0,
{0},0,1,0,48312c09-257f-4b29-b280-284dd89efc1e}
},0,1,2,
{1,
{1,0},0},0,0},
{"U"},1,0,0,1,0,0,0,3,3,3},a9f3b1ac-f51b-431e-b102-55a69acdecad,
{25,
{10,02023637-7868-4a5f-8576-835a76e0c9ba},0,1,
{0,
{0,
{"B",1},0}
},0,"ФормаСправка",
{1,0},1,
{0,39bb0fe9-771d-4dd5-8a6e-2d16984523af},
{0},3,0,0,0,2,2,0,0,0,
{3,4,
{0}
},
{3,4,
{0}
},
{3,4,
{0}
},
{7,3,0,1,100},
{0,0,0},0,
{4,0,
{0},"",-1,-1,1,0,""},1,
{"Pattern"},"",2,0,1,
{8,
{20,02023637-7868-4a5f-8576-835a76e0c9ba},0,0,1,
{0,
{0,
{"B",1},0}
},0,"ФормаСправкаExtendedTooltip",
{1,0},
{1,0},1,0,0,2,2,
{3,4,
{0}
},
{7,3,0,1,100},
{0,0,0},1,
{5,0,0,3,0,
{0},
{3,4,
{0}
},
{3,4,
{0}
},
{3,0,
{0},0,1,0,48312c09-257f-4b29-b280-284dd89efc1e}
},0,1,2,
{1,
{1,0},0},0,0},
{"U"},1,0,0,1,0,0,0,3,3,3},1,0,1,
{8,
{14,02023637-7868-4a5f-8576-835a76e0c9ba},0,0,1,
{0,
{0,
{"B",1},0}
},0,"ГруппаКоманднаяПанельExtendedTooltip",
{1,0},
{1,0},1,0,0,2,2,
{3,4,
{0}
},
{7,3,0,1,100},
{0,0,0},1,
{5,0,0,3,0,
{0},
{3,4,
{0}
},
{3,4,
{0}
},
{3,0,
{0},0,1,0,48312c09-257f-4b29-b280-284dd89efc1e}
},0,1,2,
{1,
{1,0},0},0,0}
},77ffcc29-7f2d-4223-b22f-19666e7250ba,
{32,
{1,02023637-7868-4a5f-8576-835a76e0c9ba},0,0,1,
{0,
{0,
{"B",1},0}
},6,"ПолеТабличногоДокумента",0,0,
{1,0},
{1,0},
{1,
{2}
},
{0},1,0,2,1,2,
{1,0},
{1,0},1,1,0,3,0,3,1,3,0,
{4,0,
{0},"",-1,-1,1,0,""},
{4,0,
{0},"",-1,-1,1,0,""},
{3,4,
{0}
},
{7,3,0,1,100},
{3,4,
{0}
},
{3,4,
{0}
},
{3,4,
{0}
},
{7,3,0,1,100},
{0,0,0},1,
{8,50,10,1,1,0,0,1,1,0,0,1,0,0,1,
{3,4,
{0}
},1,1,
{1,2988b2a5-c887-4928-94ae-5d0c9c31e999,"ПолеТабличногоДокументаОбработкаРасшифровки"},0},
{0},1,
{19,
{2,02023637-7868-4a5f-8576-835a76e0c9ba},0,0,1,
{0,
{0,
{"B",1},0}
},8,"ПолеТабличногоДокументаКонтекстноеМеню",
{1,0},
{1,0},0,1,0,0,0,2,2,
{3,4,
{0}
},
{7,3,0,1,100},
{0,0,0},1,
{1,1},0,1,0,0},1,
{"Pattern"},
{"Pattern"},"","",
{0},0,0,1,
{8,
{21,02023637-7868-4a5f-8576-835a76e0c9ba},0,0,1,
{0,
{0,
{"B",1},0}
},0,"ПолеТабличногоДокументаExtendedTooltip",
{1,0},
{1,0},1,0,0,2,2,
{3,4,
{0}
},
{7,3,0,1,100},
{0,0,0},1,
{5,0,0,3,0,
{0},
{3,4,
{0}
},
{3,4,
{0}
},
{3,0,
{0},0,1,0,48312c09-257f-4b29-b280-284dd89efc1e}
},0,1,2,
{1,
{1,0},0},0,0}
},3d3cb80c-508b-41fa-8a18-680cdf5f1712,
{8,
{8,02023637-7868-4a5f-8576-835a76e0c9ba},0,0,1,
{0,
{0,
{"B",1},0}
},1,"Информация32",
{1,0},
{1,0},0,0,0,2,2,
{3,4,
{0}
},
{7,3,0,1,100},
{0,0,0},1,
{2,
{4,3,
{0},"",-1,-1,0,
{
{#base64:iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAGXRFWHRTb2Z0d2Fy
ZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAArJJREFUeNqsV91KW0EQ7llONaapMRIt
Km20WlT8uSjohQ/QG5/Hl7Cv0Ut9Bou2etNeiCgo1bT+YoigVdNqlPiNzMp2e447
e44HPpaQnZlv529ng0aj8Uz6lT9mC1heAi+AFiADBMA1cAVcAmd9M7WqVGfgIgCj
zVi6gXYgZIMayvqtcQsQiTLI/ElMAMZ7sPTEGHGR0NgBiR9eBPjU79jVQUoChHPg
e5Q3/iMA41ksw8BzgWKK+z7wF+h0eOsGWAGJs1gCfPIxjrXrZBTnZSi8MeSJeK+D
xAJkalpGWR4Z5JMrw71xODGN8/fTIUMHnDIFlMH+NZacJfAYidaInCo6CBAKsDXy
DwF2/RuBsIk85Hqt3HkrlB3Dfkrw+1jTV3LEPO6/ESgawkrZnfeoCsI4JaUSuu6x
UDQBbcK9Jkr3VbAz20LGR5+o3n33L1AICh7Kqe73qAKAOldMNzetJCS6Qr5cJASo
iZxEZH6Vk7gvAYEiEcgKCbznzD1nMjWDxC+gP4EX8ooJSBJH94g2DtvDBzKVhAnc
GlqbpAlWt+6PpoRlHIScWFlPEpdWHrwSyEb9fxHyTZbzSByaeGwCXULy9p4LxUnl
04IrEZVQ8tShUVVc08qjk1Ws+Of4YpIYtHUfKLjziO92EQns30t5eq27TqOavguO
Uri/6NH/TWyb88CGsH6PIwjkExgn3csPBDir1wUkmiMIXHvegsqcDZXRzdaoxByC
QxEEvgLfGIeSzIetL3Ez4WceHOO8kEHWj1ttmMp4lcs54zBOHXTeNZbTC2ia3R3X
RKh0y7yHxvEO45kW18woVJ9A+FjyMKEr+oOR4WkHEqqeORg/9X2aTWCZSEliCYYX
0zxOqctNAgPscgkJcvcWGz9N9Tq2yPTz+N7Jc4GehH8zyNW7MLop1XknwABKrNn9
1daFowAAAABJRU5ErkJggg==}
},0,""},0,0,0,
{1,0},
{3,4,
{0}
},
{3,0,
{0},0,1,0,48312c09-257f-4b29-b280-284dd89efc1e},0,0,
{0}
},1,
{19,
{9,02023637-7868-4a5f-8576-835a76e0c9ba},0,0,1,
{0,
{0,
{"B",1},0}
},8,"Информация32КонтекстноеМеню",
{1,0},
{1,0},0,1,0,0,0,2,2,
{3,4,
{0}
},
{7,3,0,1,100},
{0,0,0},1,
{1,1},0,1,0,0},0,2,
{1,
{1,0},0},0,1,
{8,
{22,02023637-7868-4a5f-8576-835a76e0c9ba},0,0,1,
{0,
{0,
{"B",1},0}
},0,"Информация32ExtendedTooltip",
{1,0},
{1,0},1,0,0,2,2,
{3,4,
{0}
},
{7,3,0,1,100},
{0,0,0},1,
{5,0,0,3,0,
{0},
{3,4,
{0}
},
{3,4,
{0}
},
{3,0,
{0},0,1,0,48312c09-257f-4b29-b280-284dd89efc1e}
},0,1,2,
{1,
{1,0},0},0,0}
},"","",1,
{19,
{0},0,0,0,7,"Navigator",
{1,0},
{1,0},0,1,0,0,0,2,2,
{3,4,
{0}
},
{7,3,0,1,100},
{0,0,0},0,0,1,0,1,
{8,
{0},0,0,0,0,"NavigatorExtendedTooltip",
{1,0},
{1,0},1,0,0,2,2,
{3,4,
{0}
},
{7,3,0,1,100},
{0,0,0},1,
{5,0,0,3,0,
{0},
{3,4,
{0}
},
{3,4,
{0}
},
{3,0,
{0},0,1,0,48312c09-257f-4b29-b280-284dd89efc1e}
},0,1,2,
{1,
{1,0},0},0,0}
},1,"",2,0,1,
{19,
{0},0,0,0,7,"LeftCaptionButtons",
{1,0},
{1,0},0,1,0,0,0,2,2,
{3,4,
{0}
},
{7,3,0,1,100},
{0,0,0},0,0,1,0,1,
{8,
{0},0,0,0,0,"LeftCaptionButtonsExtendedTooltip",
{1,0},
{1,0},1,0,0,2,2,
{3,4,
{0}
},
{7,3,0,1,100},
{0,0,0},1,
{5,0,0,3,0,
{0},
{3,4,
{0}
},
{3,4,
{0}
},
{3,0,
{0},0,1,0,48312c09-257f-4b29-b280-284dd89efc1e}
},0,1,2,
{1,
{1,0},0},0,0}
},1,
{19,
{0},0,0,0,7,"RightCaptionButtons",
{1,0},
{1,0},0,1,0,0,0,2,2,
{3,4,
{0}
},
{7,3,0,1,100},
{0,0,0},0,0,1,0,1,
{8,
{0},0,0,0,0,"RightCaptionButtonsExtendedTooltip",
{1,0},
{1,0},1,0,0,2,2,
{3,4,
{0}
},
{7,3,0,1,100},
{0,0,0},1,
{5,0,0,3,0,
{0},
{3,4,
{0}
},
{3,4,
{0}
},
{3,0,
{0},0,1,0,48312c09-257f-4b29-b280-284dd89efc1e}
},0,1,2,
{1,
{1,0},0},0,0}
}
},"

////////////////////////////////////////////////////////////////////////////////
// СЛУЖЕБНЫЕ ПРОЦЕДУРЫ И ФУНКЦИИ

//Василий Демидов aka Душелов

&НаКлиенте
Функция ПолучитьПолноеИмяФормы(ИмяФормы)
	
	СимволТочка = ""."";
	ПозицияПоследнейТочки = СтрДлина(ЭтаФорма.ИмяФормы);
	Пока Сред(ЭтаФорма.ИмяФормы, ПозицияПоследнейТочки, 1) <> СимволТочка Цикл 
		ПозицияПоследнейТочки = ПозицияПоследнейТочки - 1;
	КонецЦикла; // 
	Возврат Лев(ЭтаФорма.ИмяФормы, ПозицияПоследнейТочки) + ИмяФормы;
	
КонецФункции

//Василий Демидов aka Душелов

&НаСервере
Функция ПолучитьМассивАктивныхПользователей()
	
	МассивПользователей = Новый Массив;
	МассивСоединений = ПолучитьСоединенияИнформационнойБазы();
	НомерТекущегоСоединения = НомерСоединенияИнформационнойБазы();
	
	Для Каждого Соединение ИЗ МассивСоединений Цикл
		Если Соединение.Пользователь <> Неопределено Тогда
			Если Соединение.ИмяПриложения <> ""Designer"" И Соединение.НомерСоединения <> НомерТекущегоСоединения Тогда
				МассивПользователей.Добавить(Соединение.Пользователь.Имя);
			КонецЕсли;
		КонецЕсли;
	КонецЦикла;	
	
	Возврат МассивПользователей;
	
КонецФункции
			
&НаСервере
Процедура ИзменитьРоль(Пользователь, Роль, ДобавитьРоль)
	
	Если ДобавитьРоль Тогда
		Пользователь.Роли.Добавить(Роль);
	Иначе
		Пользователь.Роли.Удалить(Роль);
	КонецЕсли; 
	Пользователь.Записать();
	
КонецПроцедуры

&НаСервере
Функция НазначитьРольСервер(ПользовательИмя, РольИмя, РольДоступна = Неопределено)
	
	Роль = Метаданные.Роли[РольИмя];
	Пользователь = ПользователиИнформационнойБазы.НайтиПоИмени(ПользовательИмя);
	Если Пользователь <> Неопределено Тогда
		Если РольДоступна Тогда
			Если Не Пользователь.Роли.Содержит(Роль) Тогда
				ИзменитьРоль(Пользователь, Роль, Истина);
			КонецЕсли;
		Иначе
			Если Пользователь.Роли.Содержит(Роль) Тогда
				ИзменитьРоль(Пользователь, Роль, Ложь);
			КонецЕсли;
		КонецЕсли;
		
		Возврат Пользователь.Роли.Содержит(Роль);
	КонецЕсли;
	
	Возврат Ложь;
	
КонецФункции
            
&НаСервере
Функция НайтиПользователяСервер(КодПользователя, ИмяПользователя)
	
	НайденнаяСсылка = Справочники.Пользователи.НайтиПоКоду(КодПользователя);
	Если НайденнаяСсылка = Неопределено ИЛИ НайденнаяСсылка.Пустая() Тогда
		НайденнаяСсылка = Справочники.Пользователи.НайтиПоНаименованию(ИмяПользователя);
	КонецЕсли; 
	Возврат НайденнаяСсылка;
	
КонецФункции

&НаКлиенте
Процедура УстановитьДляОбластиЯчеек(ТабличныйДокумент, РольДоступна)
	
	МассивАктивныхПользователей = ПолучитьМассивАктивныхПользователей();
	МассивПользователей = Новый Массив;
	РолиИзменены = Ложь;
	Для Каждого Область из ТабличныйДокумент.ВыделенныеОбласти Цикл
		Для Лево = Область.Лево по Область.Лево + (Область.Право - Область.Лево) Цикл
			Для Верх = Область.Верх по Область.Верх + (Область.Низ - Область.Верх) Цикл
				Ячейка = ТабличныйДокумент.Область(Верх, Лево);
				Если НазначитьРоль(Ячейка, РольДоступна, Ложь)  Тогда
					РолиИзменены = Истина;
					ПользовательИмя = Ячейка.Расшифровка.Пользователь;
					Если (МассивАктивныхПользователей.Найти(ПользовательИмя) <> Неопределено 
						И МассивПользователей.Найти(ПользовательИмя) = Неопределено) Тогда
						МассивПользователей.Добавить(ПользовательИмя);
					КонецЕсли;  
				КонецЕсли;
			КонецЦикла;
		КонецЦикла;
	КонецЦикла;
	
	Если РолиИзменены Тогда
		ПоказатьОповещениеПользователя(""Состав ролей пользователям"", , ""изменен"", Элементы.Информация32.Картинка);
	КонецЕсли; 
	
	Если МассивПользователей.Количество() > 0 Тогда
		
		ТекстСообщенияОбИзменениях = НСтр(""ru = 'Были изменены роли пользователей, которые в данный момент работают с ИБ %1 
							|Для них новые значения вступят в силу только после перезапуска их сеанса работы с программой'"");
		СписокПользователей = """";
		Для Каждого Пользователь ИЗ МассивПользователей Цикл
			СписокПользователей = СписокПользователей + ?(СписокПользователей = """", ""("", "" ;"") + Пользователь;
		КонецЦикла;
		СписокПользователей = СписокПользователей + "")"";
		ТекстСообщенияОбИзменениях = СтрЗаменить(ТекстСообщенияОбИзменениях, ""%1"", СписокПользователей);
		ОчиститьСообщения();
		Сообщение = Новый СообщениеПользователю;
		Сообщение.Текст = ТекстСообщенияОбИзменениях;
		Сообщение.Сообщить();
		
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Функция НазначитьРоль(Ячейка, РольДоступна = Неопределено, ПоказыватьОповещение = Истина)
	
	Если Ячейка.ТипОбласти <> ТипОбластиЯчеекТабличногоДокумента.Прямоугольник Тогда
		Возврат Ложь;
	ИначеЕсли ТипЗнч(Ячейка.Расшифровка) <> Тип(""Структура"") Тогда
		Возврат Ложь;
	ИначеЕсли НЕ Ячейка.Расшифровка.Свойство(""Роль"") Тогда
		Возврат Ложь;
	КонецЕсли;
	
	Если РольДоступна = Неопределено Тогда
		РольДоступна = Не Ячейка.Значение;
	КонецЕсли;
	
	ПользовательИмя = Ячейка.Расшифровка.Пользователь;
	РольИмя = Ячейка.Расшифровка.Роль;
	
	Ячейка.Значение = НазначитьРольСервер(ПользовательИмя, РольИмя, РольДоступна);
	Ячейка.ЦветФона = WebЦвета.ЗеленоЖелтый;
	
	Если ПоказыватьОповещение Тогда
		
		МассивАктивныхПользователей = ПолучитьМассивАктивныхПользователей();
		Если МассивАктивныхПользователей.Найти(ПользовательИмя) <> Неопределено Тогда
			ТекстСообщенияОбИзменениях = НСтр(""ru = 'Пользователь %1 в настоящий момент работает в ИБ.
								|Для него новые значения вступят в силу только после перезапуска сеанса работы с программой'"");
			ТекстСообщенияОбИзменениях = СтрЗаменить(ТекстСообщенияОбИзменениях, ""%1"", ПользовательИмя);
			ОчиститьСообщения();
			Сообщение = Новый СообщениеПользователю;
			Сообщение.Текст = ТекстСообщенияОбИзменениях;
			Сообщение.Сообщить();
		КонецЕсли; 

		Если Ячейка.Значение Тогда
			ПоказатьОповещениеПользователя(""Роль установлена"", , ПользовательИмя, Элементы.Информация32.Картинка);
		Иначе 
			ПоказатьОповещениеПользователя(""Роль снята"", , ПользовательИмя, Элементы.Информация32.Картинка);
		КонецЕсли;
		
	КонецЕсли; 
	
	Возврат Истина;
	
КонецФункции

&НаКлиенте
Процедура ВыделитьТекущуюКолонку(ТабличныйДокумент, ЯчейкаЗаголовокКолонки)
	
	//Выделяем ячейки текущей колонки
	
	МассивОбластей = Новый Массив;
	Область = ТабличныйДокумент.Область(ЯчейкаЗаголовокКолонки.Низ + 1, ЯчейкаЗаголовокКолонки.Лево, ТабличныйДокумент.ВысотаТаблицы - 1);
	МассивОбластей.Добавить(Область);
	
	Элементы.ПолеТабличногоДокумента.УстановитьВыделенныеОбласти(МассивОбластей);
	
КонецПроцедуры

//Заполняет реквизит ТаблицуПользователей
//
//Параметры
//	Нет.
//
//
&НаСервере
Функция СформироватьТаблицуПользователей() 
	
	ТаблицаПользователейОбъект = РеквизитФормыВЗначение(""ТаблицаПользователей"");
	ТаблицаПользователейОбъект.Очистить();
	ТаблицаПользователейОбъект.Колонки.Очистить();
	ТаблицаПользователейОбъект.Колонки.Добавить(""Пользователь"");
	ТаблицаПользователейОбъект.Колонки.Добавить(""Имя"");
	ТаблицаПользователейОбъект.Колонки.Добавить(""ПолноеИмя"");
	
	Для Каждого Пользователь из ПользователиИнформационнойБазы.ПолучитьПользователей() Цикл
		НоваяСтрока = ТаблицаПользователейОбъект.Добавить();
		НоваяСтрока.Пользователь = Пользователь;
		НоваяСтрока.Имя = Пользователь.Имя;
		НоваяСтрока.ПолноеИмя = ?(ЗначениеЗаполнено(Пользователь.ПолноеИмя) И СокрЛП(Пользователь.ПолноеИмя) <> СокрЛП(Пользователь.Имя), ""; "" + Пользователь.ПолноеИмя, """");
	КонецЦикла;
	
	ТаблицаПользователейОбъект.Сортировать(""Имя"");
	ЗначениеВРеквизитФормы(ТаблицаПользователейОбъект, ""ТаблицаПользователей"");
	
	Возврат ТаблицаПользователейОбъект;
	
КонецФункции

//Формирует матрицу ролей - табличный документ
//
//Параметры
// ТабличныйДокумент - ТабличныйДокумент - возвращаемый табличный документ
//
//
&НаСервере
Процедура СформироватьТабличныйДокумент(ТабличныйДокумент = Неопределено, СписокРолей, ТаблицаПользователей)
	
	Если ТабличныйДокумент = Неопределено Тогда
		ТабличныйДокумент = Новый ТабличныйДокумент;
	Иначе
		ТабличныйДокумент.Очистить();
		ТабличныйДокумент.ВыделенныеОбласти.Очистить();
	КонецЕсли;  
	
	ЭтотОбъект = РеквизитФормыВЗначение(""Объект"");
	Макет = ЭтотОбъект.ПолучитьМакет(""Макет"");
	
	ТабличныйДокумент.Вывести(Макет.ПолучитьОбласть(""Шапка|ПервыйСтолбец""));
	ТабличныйДокумент.ФиксацияСлева = ТабличныйДокумент.ШиринаТаблицы;
	
	Для каждого Роль Из СписокРолей Цикл
		Область = Макет.ПолучитьОбласть(""Шапка|Столбец"");
		Область.Параметры.Роль = Роль.Значение;
		Область.Параметры.Заголовок = Новый Структура(""Заголовок"", Истина);
		ТабличныйДокумент.Присоединить(Область);
	КонецЦикла;  
	
	ТабличныйДокумент.Присоединить(Макет.ПолучитьОбласть(""Шапка|ПоследнийСтолбец""));
	ТабличныйДокумент.ФиксацияСверху = ТабличныйДокумент.ВысотаТаблицы;
	
	ИмяТекущегоПользователя = ПользователиИнформационнойБазы.ТекущийПользователь().Имя;
	МассивАктивныхПользователей = ПолучитьМассивАктивныхПользователей();
	Для Каждого СтрокаТЗ из ТаблицаПользователей Цикл
		Пользователь = СтрокаТЗ.Пользователь;
		ИмяПользователя = СтрокаТЗ.Имя;
		
		Область = Макет.ПолучитьОбласть(""Строка|ПервыйСтолбец"");
		Область.Параметры.Пользователь = ИмяПользователя + СтрокаТЗ.ПолноеИмя;
		Если ЕстьСправочникПользователи Тогда
			Область.Параметры.ПользовательИмя = Новый Структура(""ПользовательИмя"", ИмяПользователя);
		КонецЕсли;
		ОбластьИмениПользователя = Область.Область(1,2);
		Если ИмяПользователя = ИмяТекущегоПользователя Тогда
			ОбластьИмениПользователя.ЦветФона = WindowsЦвета.Подсвеченный;
			ОбластьИмениПользователя.Шрифт = Новый Шрифт(,, Истина);
		ИначеЕсли МассивАктивныхПользователей.Найти(ИмяПользователя) <> Неопределено Тогда
			ОбластьИмениПользователя.ЦветФона = WebЦвета.БледноЗеленый;
		КонецЕсли; 
		
		ТабличныйДокумент.Вывести(Область);
		
		Для каждого Роль Из СписокРолей Цикл
			Область = Макет.ПолучитьОбласть(""Строка|Столбец"");
			Область.Параметры.РольДоступна = Пользователь.Роли.Содержит(Метаданные.Роли[Роль.Ключ]);
			Область.Параметры.ПользовательРоль = Новый Структура(""Пользователь, Роль"", ИмяПользователя, Роль.Ключ);
			ТабличныйДокумент.Присоединить(Область);
		КонецЦикла;
		
		ТабличныйДокумент.Присоединить(Макет.ПолучитьОбласть(""Строка|ПоследнийСтолбец""));
	КонецЦикла;
	
	ТабличныйДокумент.Вывести(Макет.ПолучитьОбласть(""Подвал|ПервыйСтолбец""));
	Для каждого Роль Из СписокРолей Цикл
		Область = Макет.ПолучитьОбласть(""Подвал|Столбец"");
		ТабличныйДокумент.Присоединить(Область);
	КонецЦикла;
	ТабличныйДокумент.Присоединить(Макет.ПолучитьОбласть(""Подвал|ПоследнийСтолбец""));
	
	ТабличныйДокумент.ОбластьПечати = ТабличныйДокумент.Область(2, 1, ТабличныйДокумент.ВысотаТаблицы, ТабличныйДокумент.ШиринаТаблицы);
	ТабличныйДокумент.ПовторятьПриПечатиСтроки = ТабличныйДокумент.Область(2, , ТабличныйДокумент.ФиксацияСверху + 1);
	ТабличныйДокумент.ОтображатьСетку = Ложь;
	
КонецПроцедуры

&НаСервере
Процедура ОбновитьТабличныйДокументНаСервере()
	
	ТаблицаПользователейОбъект = СформироватьТаблицуПользователей();
	СформироватьТабличныйДокумент(ПолеТабличногоДокумента, СтруктураРолей, ТаблицаПользователейОбъект);
	
КонецПроцедуры

// Проверить права текущего пользователя на администрирование пользователей информационной базы.
//
&НаСервере
Функция ЕстьПраваНаАдминистрирование() 
	
	Возврат ПравоДоступа(""Администрирование"", Метаданные, ПользователиИнформационнойБазы.ТекущийПользователь());
	
КонецФункции	

////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ ФОРМЫ

//Процедура-обработчик события ""ПриСозданииНаСервере"" формы
//
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Если Не ЕстьПраваНаАдминистрирование() Тогда
		Возврат;
	КонецЕсли; 
	
	//При открытии или инициализации проверяем переданный программно таблицу ролей для формирования
	//матрицы. 
	//Если таблица пустая, формируем её из метаданных конфигурации
	Если ТипЗнч(Параметры.СтруктураРолей) = Тип(""Структура"") И Параметры.СтруктураРолей.Количество() > 0 Тогда
		СтруктураРолей = Параметры.СтруктураРолей;
	Иначе
		СтруктураРолей = Новый Структура;
		Для каждого Роль Из Метаданные.Роли Цикл
			СтруктураРолей.Вставить(Роль.Имя, Роль.Синоним);
		КонецЦикла;
	КонецЕсли; 
	
	//Проверка наличия в конфигурации справочника Пользователи.
	ЕстьСправочникПользователи = Метаданные.Справочники.Найти(""Пользователи"") <> Неопределено;
	
	ОбновитьТабличныйДокументНаСервере();
	
КонецПроцедуры

//Процедура-обработчик события ""ПриОткрытии"" формы
//
&НаКлиенте
Процедура ПриОткрытии(Отказ)
	
	Если НЕ ЕстьПраваНаАдминистрирование() Тогда
		Предупреждение(НСтр(""ru = 'Для использования обработки необходимо иметь право доступа """"Администрирование""""'""));
		Отказ = Истина;
	КонецЕсли; 
	
КонецПроцедуры

//Процедура-обработчик события ""ОбработкаВыбора"" формы
//
&НаКлиенте
Процедура ОбработкаВыбора(ВыбранноеЗначение, ИсточникВыбора)
	
	Если ТипЗнч(ВыбранноеЗначение) = Тип(""Структура"") Тогда
		Если ВыбранноеЗначение.Свойство(""СтруктураРолей"") Тогда
			СтруктураРолей = ВыбранноеЗначение.СтруктураРолей;
			ОбновитьТабличныйДокументНаСервере();
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ ЭЛЕМЕНТОВ ФОРМЫ

// Обработчик события ОбработкаРасшифровки элемента ПолеТабличногоДокумента.
//
&НаКлиенте
Процедура ПолеТабличногоДокументаОбработкаРасшифровки(Элемент, Расшифровка, СтандартнаяОбработка)
	
	ТекущаяЯчейка = ПолеТабличногоДокумента.ВыделенныеОбласти[0];
	
	СтандартнаяОбработка = Ложь;
	
	Если ТипЗнч(ТекущаяЯчейка.Расшифровка) = Тип(""Структура"") И ТекущаяЯчейка.Расшифровка.Свойство(""Роль"") Тогда
		//Кликнули по ячейке
		
		НазначитьРоль(ТекущаяЯчейка);
		
	ИначеЕсли ТипЗнч(ТекущаяЯчейка.Расшифровка) = Тип(""Структура"") И ТекущаяЯчейка.Расшифровка.Свойство(""ПользовательИмя"") Тогда
		//Кликнули по ячейке с именем пользователя
		
		//Ищем в справочнике и открываем форму элемента пользователя
		Если ЕстьСправочникПользователи Тогда
			КодПользователя = СокрЛП(ТекущаяЯчейка.Расшифровка.ПользовательИмя);
			ИмяПользователя = СокрЛП(Сред(ТекущаяЯчейка.Текст, Найти(ТекущаяЯчейка.Текст, "";"") + 1));
			НайденнаяСсылка = НайтиПользователяСервер(КодПользователя, ИмяПользователя);
			Если НЕ (НайденнаяСсылка = Неопределено ИЛИ НайденнаяСсылка.Пустая()) Тогда
				ПараметрыФормы = Новый Структура(""Ключ"", НайденнаяСсылка);
				ОткрытьФорму(""Справочник.Пользователи.ФормаОбъекта"", ПараметрыФормы, ЭтаФорма);
			КонецЕсли; 
		КонецЕсли; 
		
	ИначеЕсли ТипЗнч(ТекущаяЯчейка.Расшифровка) = Тип(""Структура"") И ТекущаяЯчейка.Расшифровка.Свойство(""Заголовок"") Тогда	
		//Кликнули по заголовку колонки
		
		//Выделяем ячейки текущей колонки
		ВыделитьТекущуюКолонку(ПолеТабличногоДокумента, ТекущаяЯчейка);
		
	КонецЕсли;

КонецПроцедуры

/////////////////////////////////////////////////
// ОБРАБОТЧИКИ КОМАНД 
// 

//Процедура-обработчик команды ""СписокРолей""
//
&НаКлиенте
Процедура СписокРолей(Команда)
	
	ПараметрыФормы = Новый Структура(""СтруктураРолей"", СтруктураРолей);
	ОткрытьФормуМодально(ПолучитьПолноеИмяФормы(""ФормаВыборРолейУправляемоеПриложение""), ПараметрыФормы, ЭтаФорма);
	
КонецПроцедуры

//Процедура-обработчик команды ""Установить""
//
&НаКлиенте
Процедура Установить(Команда)
	
	УстановитьДляОбластиЯчеек(ПолеТабличногоДокумента, Истина);
	
КонецПроцедуры

//Процедура-обработчик команды ""Снять""
//
&НаКлиенте
Процедура Снять(Команда)
	
	УстановитьДляОбластиЯчеек(ПолеТабличногоДокумента, Ложь);
	
КонецПроцедуры

//Процедура-обработчик команды ""Обновить""
//
&НаКлиенте
Процедура Обновить(Команда)
	
	ОбновитьТабличныйДокументНаСервере();
	
КонецПроцедуры

//Процедура-обработчик команды ""Проголосовать""
//
&НаКлиенте
Процедура Проголосовать(Команда)
	
	ЗапуститьПриложение(""http://infostart.ru/public/85228/?rate=1"");
	
КонецПроцедуры
",
{4,5,
{9,
{1},0,"Объект",
{1,0},
{"Pattern",
{"#",753329f1-1c39-492d-b58d-51c7756e4ec8}
},
{0,
{0,
{"B",1},0}
},
{0,
{0,
{"B",1},0}
},
{0,0},
{0,0},1,0,0,0,
{0,0},
{0,0}
},
{9,
{2},0,"ПолеТабличногоДокумента",
{1,1,
{"ru","Поле табличного документа"}
},
{"Pattern",
{"#",e603103e-a318-4edc-a014-b1c6cf94d49f}
},
{0,
{0,
{"B",1},0}
},
{0,
{0,
{"B",1},0}
},
{0,0},
{0,0},0,0,0,0,
{0,0},
{0,0}
},
{9,
{7},0,"СтруктураРолей",
{1,1,
{"ru","Структура ролей"}
},
{"Pattern"},
{0,
{0,
{"B",1},0}
},
{0,
{0,
{"B",1},0}
},
{0,0},
{0,0},0,0,0,0,
{0,0},
{0,0}
},
{9,
{8},0,"ТаблицаПользователей",
{1,1,
{"ru","Таблица пользователей"}
},
{"Pattern",
{"#",acf6192e-81ca-46ef-93a6-5a6968b78663}
},
{0,
{0,
{"B",1},0}
},
{0,
{0,
{"B",1},0}
},
{0,0},
{0,0},0,0,0,0,
{0,0},
{0,0}
},
{9,
{6},0,"ЕстьСправочникПользователи",
{1,1,
{"ru","Есть справочник пользователи"}
},
{"Pattern",
{"B"}
},
{0,
{0,
{"B",1},0}
},
{0,
{0,
{"B",1},0}
},
{0,0},
{0,0},0,0,0,0,
{0,0},
{0,0}
},0,0,
{#base64:77u/PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4NCjxTZXR0
aW5ncyB4bWxucz0iaHR0cDovL3Y4LjFjLnJ1LzguMS9kYXRhLWNvbXBvc2l0aW9u
LXN5c3RlbS9zZXR0aW5ncyIgeG1sbnM6ZGNzY29yPSJodHRwOi8vdjguMWMucnUv
OC4xL2RhdGEtY29tcG9zaXRpb24tc3lzdGVtL2NvcmUiIHhtbG5zOnN0eWxlPSJo
dHRwOi8vdjguMWMucnUvOC4xL2RhdGEvdWkvc3R5bGUiIHhtbG5zOnN5cz0iaHR0
cDovL3Y4LjFjLnJ1LzguMS9kYXRhL3VpL2ZvbnRzL3N5c3RlbSIgeG1sbnM6djg9
Imh0dHA6Ly92OC4xYy5ydS84LjEvZGF0YS9jb3JlIiB4bWxuczp2OHVpPSJodHRw
Oi8vdjguMWMucnUvOC4xL2RhdGEvdWkiIHhtbG5zOndlYj0iaHR0cDovL3Y4LjFj
LnJ1LzguMS9kYXRhL3VpL2NvbG9ycy93ZWIiIHhtbG5zOndpbj0iaHR0cDovL3Y4
LjFjLnJ1LzguMS9kYXRhL3VpL2NvbG9ycy93aW5kb3dzIiB4bWxuczp4cz0iaHR0
cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEiIHhtbG5zOnhzaT0iaHR0cDov
L3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiLz4=}
},
{0,2,
{0,"АдресТаблицыРолей",
{"Pattern",
{"S"}
},0},
{0,"СтруктураРолей",
{"Pattern"},0}
},
{0,5,
{7,
{1,409b9a53-7f7e-4178-86c1-33176c7c7a7a},"СписокРолей",
{1,1,
{"ru","Отбор по ролям"}
},
{1,1,
{"ru","Выбрать необходимые роли"}
},
{0,
{0,
{"B",1},0}
},
{0,0,0},
{4,1,
{0,0bac63da-5b4e-48af-b593-7c5d29663e83},"",-1,-1,1,0,""},"СписокРолей",2,0,0,
{0,0},1,0},
{7,
{2,409b9a53-7f7e-4178-86c1-33176c7c7a7a},"Установить",
{1,1,
{"ru","Установить всем"}
},
{1,1,
{"ru","Установить текущую роль всем выделенным пользователям"}
},
{0,
{0,
{"B",1},0}
},
{0,0,0},
{4,1,
{-10},"",-1,-1,1,0,""},"Установить",2,0,0,
{0,0},1,0},
{7,
{3,409b9a53-7f7e-4178-86c1-33176c7c7a7a},"Снять",
{1,1,
{"ru","Снять у всех"}
},
{1,1,
{"ru","Снять текущую роль у всех выделенных пользователей"}
},
{0,
{0,
{"B",1},0}
},
{0,0,0},
{4,1,
{-11},"",-1,-1,1,0,""},"Снять",2,0,0,
{0,0},1,0},
{7,
{4,409b9a53-7f7e-4178-86c1-33176c7c7a7a},"Обновить",
{1,1,
{"ru","Обновить"}
},
{1,1,
{"ru","Обновить таблицу"}
},
{0,
{0,
{"B",1},0}
},
{0,0,0},
{4,1,
{0,fc4f29e0-d168-4fe0-8e64-e982fabf2595},"",-1,-1,1,0,""},"Обновить",2,0,0,
{0,0},1,0},
{7,
{5,409b9a53-7f7e-4178-86c1-33176c7c7a7a},"Проголосовать",
{1,1,
{"ru","Проголосовать"}
},
{1,1,
{"ru","Проголосовать за обработку на Инфостарт.ру"}
},
{0,
{0,
{"B",1},0}
},
{0,0,0},
{4,1,
{0,1001ae3e-9289-4303-9699-3c0c17e20e61},"",-1,-1,1,0,""},"Проголосовать",3,0,0,
{0,0},1,0}
},
{0,0},
{0,0},0,0}